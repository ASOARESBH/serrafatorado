<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Controle de Acesso</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; display: flex; }
        
        /* Sidebar */
        .sidebar { position: fixed; top: 0; left: 0; width: 260px; height: 100vh; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 2rem 0; overflow-y: auto; z-index: 1000; }
        .sidebar h1 { color: #fff; font-size: 1.3rem; text-align: center; margin-bottom: 2rem; }
        .nav-menu { list-style: none; padding: 1rem; }
        .nav-item { margin-bottom: 0.5rem; }
        .nav-link { display: flex; align-items: center; padding: 0.75rem 1rem; color: #cbd5e1; text-decoration: none; border-radius: 8px; transition: all 0.2s; }
        .nav-link:hover, .nav-link.active { background: rgba(255, 255, 255, 0.1); color: #fff; }
        .nav-link i { margin-right: 0.75rem; width: 20px; }

        
        /* Main Content */
        .main-content { margin-left: 260px; padding: 2rem; width: 100%; }
        .header { background: #fff; padding: 1.5rem 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .header h1 { color: #1e293b; font-size: 1.8rem; margin: 0; }
        
        /* Welcome Section */
        .welcome { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: #fff; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; text-align: center; }
        .welcome h2 { margin-bottom: 0.5rem; font-size: 1.5rem; }
        .welcome p { opacity: 0.9; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border-left: 4px solid #3b82f6; }
        .stat-card.agua { border-left-color: #06b6d4; }
        .stat-card.abastecimento { border-left-color: #f59e0b; }
        .stat-card h3 { color: #64748b; font-size: 0.9rem; margin-bottom: 0.5rem; font-weight: 600; }
        .stat-card .value { font-size: 2rem; font-weight: bold; color: #1e293b; }
        .stat-card .subvalue { font-size: 0.85rem; color: #94a3b8; margin-top: 0.5rem; }
        .stat-card .icon { float: right; font-size: 2.5rem; opacity: 0.2; }
        
        /* Sections */
        .section { background: #fff; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        .section-title { font-size: 1.3rem; color: #1e293b; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0; display: flex; align-items: center; gap: 0.75rem; }
        .section-title i { color: #3b82f6; font-size: 1.5rem; }
        
        /* Table Styles */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f1f5f9; padding: 1rem; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0; font-size: 0.9rem; }
        td { padding: 0.75rem 1rem; border-bottom: 1px solid #e2e8f0; }
        tr:hover { background: #f8fafc; }
        
        /* Badge Styles */
        .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .badge.top-1 { background: #fef3c7; color: #92400e; }
        .badge.top-2 { background: #e5e7eb; color: #374151; }
        .badge.top-3 { background: #fed7aa; color: #92400e; }
        .badge.status-critico { background: #fee2e2; color: #991b1b; }
        .badge.status-baixo { background: #fef3c7; color: #92400e; }
        .badge.status-normal { background: #dcfce7; color: #166534; }
        
        /* Info Box */
        .info-box { background: #f0f9ff; border-left: 4px solid #0284c7; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .info-box h4 { color: #0c4a6e; margin-bottom: 0.5rem; }
        .info-box p { color: #0369a1; font-size: 0.9rem; margin: 0.25rem 0; }
        
        /* Abastecimento Info */
        .abastecimento-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .abastecimento-item { background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b; }
        .abastecimento-item h5 { color: #64748b; font-size: 0.8rem; margin-bottom: 0.5rem; }
        .abastecimento-item .value { font-size: 1.5rem; font-weight: bold; color: #1e293b; }
        
        /* Loading State */
        .loading { text-align: center; padding: 2rem; color: #94a3b8; }
        .loading i { font-size: 2rem; margin-bottom: 1rem; animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 2rem; color: #94a3b8; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
        
        /* Error State */
        .error-state { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .error-state i { margin-right: 0.5rem; }
        
        /* Menu Toggle Mobile */
        .menu-toggle { display: none; position: fixed; top: 1rem; left: 1rem; z-index: 1001; background: #1e293b; color: #fff; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.active { transform: translateX(0); }
            .menu-toggle { display: block; }
            .main-content { margin-left: 0; padding: 1rem; }
            .header { padding: 1rem; }
            .header h1 { font-size: 1.3rem; }
            .stats-grid { grid-template-columns: 1fr; gap: 1rem; }
            .section { padding: 1rem; }
            .section-title { font-size: 1.1rem; }
            th, td { padding: 0.5rem; font-size: 0.85rem; }
            .abastecimento-info { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 480px) {
            .main-content { padding: 0.5rem; }
            .section { padding: 0.75rem; }
            .stat-card { padding: 1rem; }
            .stat-card .value { font-size: 1.5rem; }
            th, td { padding: 0.25rem; font-size: 0.75rem; }
        }
    </style>
    <script src="js/sessao_manager.js"></script>
</head>
<body>
    <button class="menu-toggle" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>
    
    <nav class="sidebar" id="sidebar">
        <h1>Serra da Liberdade</h1>
        <ul class="nav-menu">
            <li class="nav-item"><a href="dashboard.html" class="nav-link active"><i class="fas fa-chart-line"></i> Dashboard</a></li>
            <li class="nav-item"><a href="moradores.html" class="nav-link"><i class="fas fa-users"></i> Moradores</a></li>
            <li class="nav-item"><a href="veiculos.html" class="nav-link"><i class="fas fa-car"></i> Veículos</a></li>
            <li class="nav-item"><a href="visitantes.html" class="nav-link"><i class="fas fa-user-friends"></i> Visitantes</a></li>
            <li class="nav-item"><a href="registro.html" class="nav-link"><i class="fas fa-clipboard-list"></i> Registro Manual</a></li>
            <li class="nav-item"><a href="acesso.html" class="nav-link"><i class="fas fa-door-open"></i> Controle de Acesso</a></li>
            <li class="nav-item"><a href="relatorios.html" class="nav-link"><i class="fas fa-file-alt"></i> Relatórios</a></li>
            <li class="nav-item"><a href="financeiro.html" class="nav-link"><i class="fas fa-money-bill-wave"></i> Financeiro</a></li>
            <li class="nav-item"><a href="configuracao.html" class="nav-link"><i class="fas fa-cog"></i> Configurações</a></li>
            <li class="nav-item"><a href="manutencao.html" class="nav-link"><i class="fas fa-tools"></i> Manutenção</a></li>
            <li class="nav-item"><a href="administrativa.html" class="nav-link"><i class="fas fa-briefcase"></i> Administrativo</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <header class="header">
            <h1><i class="fas fa-chart-line"></i> Dashboard - Sistema de Controle de Acesso</h1>
        </header>

        <div class="welcome">
            <h2><i class="fas fa-building"></i> Bem-vindo ao Sistema de Controle de Acesso</h2>
            <p>Condomínio Serra da Liberdade</p>
        </div>

        <!-- ESTATÍSTICAS GERAIS -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users icon"></i>
                <h3>Total de Moradores</h3>
                <div class="value" id="totalMoradores">-</div>
            </div>
            <div class="stat-card agua">
                <i class="fas fa-tint icon"></i>
                <h3>Consumo Total de Água</h3>
                <div class="value" id="totalConsumoAgua">-</div>
                <div class="subvalue" id="consumoMedioMorador">-</div>
            </div>
            <div class="stat-card agua">
                <i class="fas fa-dollar-sign icon"></i>
                <h3>Valor Total de Água</h3>
                <div class="value" id="totalValorAgua">-</div>
            </div>
            <div class="stat-card abastecimento">
                <i class="fas fa-gas-pump icon"></i>
                <h3>Saldo de Abastecimento</h3>
                <div class="value" id="saldoAbastecimento">-</div>
                <div class="subvalue" id="statusSaldo">-</div>
            </div>
        </div>

        <!-- SEÇÃO: TOP 10 MORADORES COM MAIOR CONSUMO DE ÁGUA -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-chart-bar"></i> Top 10 Moradores - Maior Consumo de Água
            </h2>
            
            <div id="topConsumoContainer" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Carregando dados...</p>
            </div>
        </div>

        <!-- SEÇÃO: ABASTECIMENTO DE VEÍCULOS -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-gas-pump"></i> Abastecimento de Veículos
            </h2>
            
            <div id="abastecimentoContainer" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Carregando dados...</p>
            </div>
        </div>

        <!-- SEÇÃO: HISTÓRICO DE ABASTECIMENTOS -->
        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-history"></i> Histórico de Abastecimentos (Últimos 10)
            </h2>
            
            <div id="historicoAbastecimentoContainer" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Carregando dados...</p>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // ========== CONFIGURAÇÃO ==========
        const API_BASE = '../api/api_dashboard_agua.php';
        const DEBUG = true;
        
        function log(msg, data = null) {
            if (DEBUG) {
                console.log('[Dashboard]', msg, data || '');
            }
        }

        // ========== CARREGAMENTO DE DADOS ==========
        document.addEventListener('DOMContentLoaded', function() {
            log('Iniciando carregamento de dados...');
            carregarEstatisticas();
            carregarTopConsumo();
            carregarAbastecimento();
            carregarHistoricoAbastecimento();
        });

        // ========== ESTATÍSTICAS GERAIS ==========
        function carregarEstatisticas() {
            log('Carregando estatísticas gerais...');
            
            fetch(API_BASE + '?estatisticas_gerais=1')
                .then(response => {
                    log('Resposta recebida:', response.status);
                    if (!response.ok) throw new Error('Erro HTTP: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Dados de estatísticas:', data);
                    if (data.sucesso && data.dados) {
                        const d = data.dados;
                        document.getElementById('totalMoradores').textContent = d.total_moradores || 0;
                        document.getElementById('totalConsumoAgua').textContent = (d.total_consumo_agua || 0).toLocaleString('pt-BR', {maximumFractionDigits: 0}) + ' m³';
                        document.getElementById('consumoMedioMorador').textContent = 'Média: ' + (d.consumo_medio_por_morador || 0).toLocaleString('pt-BR', {maximumFractionDigits: 2}) + ' m³/morador';
                        document.getElementById('totalValorAgua').textContent = 'R$ ' + (d.total_valor_agua || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                    }
                })
                .catch(error => {
                    log('Erro ao carregar estatísticas:', error);
                    console.error('Erro:', error);
                });

            fetch(API_BASE + '?saldo_abastecimento=1')
                .then(response => {
                    if (!response.ok) throw new Error('Erro HTTP: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Dados de saldo:', data);
                    if (data.sucesso && data.dados) {
                        const saldo = data.dados;
                        document.getElementById('saldoAbastecimento').textContent = 'R$ ' + (saldo.saldo_atual || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                        const statusEl = document.getElementById('statusSaldo');
                        statusEl.textContent = saldo.status_saldo || 'Sem dados';
                        statusEl.style.color = saldo.cor_status || '#6c757d';
                    }
                })
                .catch(error => {
                    log('Erro ao carregar saldo:', error);
                    console.error('Erro:', error);
                });
        }

        // ========== TOP 10 CONSUMO DE ÁGUA ==========
        function carregarTopConsumo() {
            log('Carregando top consumo...');
            
            fetch(API_BASE + '?top_consumo_agua=1')
                .then(response => {
                    if (!response.ok) throw new Error('Erro HTTP: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Dados de top consumo:', data);
                    if (data.sucesso && data.dados && data.dados.length > 0) {
                        renderizarTopConsumo(data.dados);
                    } else {
                        document.getElementById('topConsumoContainer').innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>Nenhum dado de consumo disponível</p></div>';
                    }
                })
                .catch(error => {
                    log('Erro ao carregar top consumo:', error);
                    console.error('Erro:', error);
                    document.getElementById('topConsumoContainer').innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i>Erro ao carregar dados: ' + error.message + '</div>';
                });
        }

        function renderizarTopConsumo(dados) {
            let html = '<div class="table-container"><table>';
            html += '<thead><tr>';
            html += '<th style="width: 50px;">Pos.</th>';
            html += '<th>Unidade</th>';
            html += '<th>Nome do Morador</th>';
            html += '<th style="text-align: right;">Consumo (m³)</th>';
            html += '<th style="text-align: right;">Valor Total</th>';
            html += '<th>Última Leitura</th>';
            html += '<th style="text-align: right;">Leitura Valor</th>';
            html += '</tr></thead><tbody>';

            dados.forEach((morador, index) => {
                let badgeClass = 'badge';
                if (index === 0) badgeClass += ' top-1';
                else if (index === 1) badgeClass += ' top-2';
                else if (index === 2) badgeClass += ' top-3';

                html += '<tr>';
                html += '<td><span class="' + badgeClass + '">#' + morador.posicao + '</span></td>';
                html += '<td><strong>' + escapeHtml(morador.unidade || '-') + '</strong></td>';
                html += '<td>' + escapeHtml(morador.nome_morador || '-') + '</td>';
                html += '<td style="text-align: right;"><strong>' + (morador.consumo_total || 0).toLocaleString('pt-BR', {maximumFractionDigits: 2}) + '</strong></td>';
                html += '<td style="text-align: right;">R$ ' + (morador.valor_total || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</td>';
                html += '<td>' + (morador.ultima_leitura_formatada || 'Sem leitura') + '</td>';
                html += '<td style="text-align: right;">' + (morador.ultima_leitura_valor || 0).toLocaleString('pt-BR', {maximumFractionDigits: 2}) + '</td>';
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            document.getElementById('topConsumoContainer').innerHTML = html;
        }

        // ========== ABASTECIMENTO DE VEÍCULOS ==========
        function carregarAbastecimento() {
            log('Carregando abastecimento...');
            
            fetch(API_BASE + '?ultimo_lancamento_abastecimento=1')
                .then(response => {
                    if (!response.ok) throw new Error('Erro HTTP: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Dados de abastecimento:', data);
                    if (data.sucesso && data.dados && Object.keys(data.dados).length > 0) {
                        renderizarAbastecimento(data.dados);
                    } else {
                        document.getElementById('abastecimentoContainer').innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>Nenhum lançamento de abastecimento registrado</p></div>';
                    }
                })
                .catch(error => {
                    log('Erro ao carregar abastecimento:', error);
                    console.error('Erro:', error);
                    document.getElementById('abastecimentoContainer').innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i>Erro ao carregar dados: ' + error.message + '</div>';
                });
        }

        function renderizarAbastecimento(lancamento) {
            let html = '<div class="info-box">';
            html += '<h4><i class="fas fa-info-circle"></i> Último Lançamento de Abastecimento</h4>';
            html += '<p><strong>Veículo:</strong> ' + escapeHtml(lancamento.modelo || '-') + ' - ' + escapeHtml(lancamento.placa || '-') + '</p>';
            html += '<p><strong>Data:</strong> ' + (lancamento.data_abastecimento_formatada || '-') + '</p>';
            html += '<p><strong>Quilometragem:</strong> ' + (lancamento.km_abastecimento || 0).toLocaleString('pt-BR') + ' km</p>';
            html += '<p><strong>Combustível:</strong> ' + escapeHtml(lancamento.tipo_combustivel || '-') + '</p>';
            html += '<p><strong>Litros:</strong> ' + (lancamento.litros || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + ' L</p>';
            html += '<p><strong>Valor:</strong> R$ ' + (lancamento.valor || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</p>';
            html += '<p><strong>Operador:</strong> ' + escapeHtml(lancamento.usuario_logado || '-') + '</p>';
            html += '</div>';

            // Carregar saldo
            fetch(API_BASE + '?saldo_abastecimento=1')
                .then(response => response.json())
                .then(data => {
                    if (data.sucesso && data.dados) {
                        const saldo = data.dados;
                        html += '<div class="abastecimento-info">';
                        html += '<div class="abastecimento-item">';
                        html += '<h5>Saldo Atual</h5>';
                        html += '<div class="value">R$ ' + (saldo.saldo_atual || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</div>';
                        html += '</div>';
                        html += '<div class="abastecimento-item">';
                        html += '<h5>Saldo Mínimo</h5>';
                        html += '<div class="value">R$ ' + (saldo.saldo_minimo || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</div>';
                        html += '</div>';
                        html += '<div class="abastecimento-item">';
                        html += '<h5>Status</h5>';
                        const statusClass = (saldo.status_saldo || 'normal').toLowerCase().replace(/ã/g, 'a').replace(/í/g, 'i');
                        html += '<div class="value"><span class="badge status-' + statusClass + '">' + (saldo.status_saldo || '-') + '</span></div>';
                        html += '</div>';
                        html += '<div class="abastecimento-item">';
                        html += '<h5>Abastecimentos Hoje</h5>';
                        html += '<div class="value">' + (saldo.abastecimentos_hoje || 0) + '</div>';
                        html += '</div>';
                        html += '</div>';
                        document.getElementById('abastecimentoContainer').innerHTML = html;
                    }
                })
                .catch(error => console.error('Erro ao carregar saldo:', error));
        }

        // ========== HISTÓRICO DE ABASTECIMENTOS ==========
        function carregarHistoricoAbastecimento() {
            log('Carregando histórico de abastecimentos...');
            
            fetch(API_BASE + '?historico_abastecimentos=1')
                .then(response => {
                    if (!response.ok) throw new Error('Erro HTTP: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('Dados de histórico:', data);
                    if (data.sucesso && data.dados && data.dados.length > 0) {
                        renderizarHistoricoAbastecimento(data.dados);
                    } else {
                        document.getElementById('historicoAbastecimentoContainer').innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>Nenhum histórico de abastecimento disponível</p></div>';
                    }
                })
                .catch(error => {
                    log('Erro ao carregar histórico:', error);
                    console.error('Erro:', error);
                    document.getElementById('historicoAbastecimentoContainer').innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i>Erro ao carregar dados: ' + error.message + '</div>';
                });
        }

        function renderizarHistoricoAbastecimento(dados) {
            let html = '<div class="table-container"><table>';
            html += '<thead><tr>';
            html += '<th>Data</th>';
            html += '<th>Veículo</th>';
            html += '<th>Placa</th>';
            html += '<th style="text-align: right;">KM</th>';
            html += '<th style="text-align: right;">Litros</th>';
            html += '<th>Combustível</th>';
            html += '<th style="text-align: right;">Valor</th>';
            html += '<th>Operador</th>';
            html += '</tr></thead><tbody>';

            dados.forEach(abastecimento => {
                html += '<tr>';
                html += '<td>' + (abastecimento.data_abastecimento_formatada || '-') + '</td>';
                html += '<td>' + escapeHtml(abastecimento.modelo || '-') + '</td>';
                html += '<td><strong>' + escapeHtml(abastecimento.placa || '-') + '</strong></td>';
                html += '<td style="text-align: right;">' + (abastecimento.km_abastecimento || 0).toLocaleString('pt-BR') + '</td>';
                html += '<td style="text-align: right;">' + (abastecimento.litros || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</td>';
                html += '<td>' + escapeHtml(abastecimento.tipo_combustivel || '-') + '</td>';
                html += '<td style="text-align: right;">R$ ' + (abastecimento.valor || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2}) + '</td>';
                html += '<td>' + escapeHtml(abastecimento.usuario_logado || '-') + '</td>';
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            document.getElementById('historicoAbastecimentoContainer').innerHTML = html;
        }

        // ========== FUNÇÕES AUXILIARES ==========
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function toggleFinanceiroMenu(e) {
            e.preventDefault();
            const submenu = e.target.closest('.nav-item').querySelector('.nav-submenu');
            submenu.classList.toggle('active');
            e.target.closest('.nav-link').classList.toggle('active');
        }

        // Fechar menu ao clicar fora (mobile)
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.menu-toggle');
            
            if (window.innerWidth <= 768 && !sidebar.contains(e.target) && !toggle.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });
    </script>
    
    <!-- Proteção de Login -->
    <script src="js/auth-guard.js"></script>
    <script src="js/user-display.js"></script>
</body>
</html>
